<div class="max-w-2xl mx-auto bg-slate-800/90 backdrop-blur-sm shadow-2xl rounded-2xl p-10 border border-slate-700">
  <h2 class="text-3xl font-bold mb-8 text-center text-white">Create Insurance Policy</h2>

  <!-- Policy Image Upload with Preview -->
  <div class="flex flex-col items-center mb-8">
    <label class="relative cursor-pointer w-32 h-32 rounded-lg overflow-hidden border-2 border-slate-600 flex items-center justify-center bg-slate-700/50 hover:border-purple-500 transition-colors">
      <!-- Show preview if image selected, else show + -->
      <img *ngIf="imagePreview" [src]="imagePreview" class="w-full h-full object-cover" />
      <span *ngIf="!imagePreview" class="text-4xl text-gray-400">📷</span>

      <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden />
    </label>
    <span *ngIf="imageName" class="text-sm text-gray-300 mt-2">{{ imageName }}</span>
    <p class="text-xs text-gray-400 mt-1">Upload policy image (max 5MB)</p>
  </div>

  <!-- Loading Message -->
  <div *ngIf="loading$ | async" class="mb-4 p-4 bg-blue-500/20 border border-blue-400/50 text-blue-300 rounded-lg backdrop-blur-sm">
    <div class="flex items-center">
      <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-300 mr-2"></div>
      Creating policy...
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error$ | async as error" class="mb-4 p-4 bg-red-500/20 border border-red-400/50 text-red-300 rounded-lg backdrop-blur-sm">
    {{ error }}
  </div>

  <!-- Success Message -->
  <div *ngIf="createdPolicy$ | async as policy" class="mb-4 p-4 bg-green-500/20 border border-green-400/50 text-green-300 rounded-lg backdrop-blur-sm">
    Policy "{{ policy.title }}" created successfully!
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
    <!-- Policy Code -->
    <div>
      <input formControlName="code" placeholder="Policy Code (e.g., AUTO-001)" 
             class="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-lg text-lg text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"
             [class.border-red-500]="form.get('code')?.invalid && form.get('code')?.touched" />
      <div *ngIf="form.get('code')?.invalid && form.get('code')?.touched" class="text-red-400 text-sm mt-1">
        <span *ngIf="form.get('code')?.errors?.['required']">Policy code is required</span>
        <span *ngIf="form.get('code')?.errors?.['minlength']">Code must be at least 3 characters</span>
      </div>
    </div>

    <!-- Policy Title -->
    <div>
      <input formControlName="title" placeholder="Policy Title" 
             class="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-lg text-lg text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"
             [class.border-red-500]="form.get('title')?.invalid && form.get('title')?.touched" />
      <div *ngIf="form.get('title')?.invalid && form.get('title')?.touched" class="text-red-400 text-sm mt-1">
        <span *ngIf="form.get('title')?.errors?.['required']">Policy title is required</span>
        <span *ngIf="form.get('title')?.errors?.['minlength']">Title must be at least 5 characters</span>
      </div>
    </div>

    <!-- Policy Description -->
    <div>
      <textarea formControlName="description" placeholder="Policy Description" rows="3"
                class="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-lg text-lg text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all resize-none"
                [class.border-red-500]="form.get('description')?.invalid && form.get('description')?.touched"></textarea>
      <div *ngIf="form.get('description')?.invalid && form.get('description')?.touched" class="text-red-400 text-sm mt-1">
        <span *ngIf="form.get('description')?.errors?.['required']">Description is required</span>
        <span *ngIf="form.get('description')?.errors?.['minlength']">Description must be at least 10 characters</span>
      </div>
    </div>

    <!-- Premium and Term -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <input formControlName="premium" type="number" placeholder="Annual Premium ($)" 
               class="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-lg text-lg text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"
               [class.border-red-500]="form.get('premium')?.invalid && form.get('premium')?.touched" />
        <div *ngIf="form.get('premium')?.invalid && form.get('premium')?.touched" class="text-red-400 text-sm mt-1">
          <span *ngIf="form.get('premium')?.errors?.['required']">Premium is required</span>
          <span *ngIf="form.get('premium')?.errors?.['min']">Premium must be at least $1</span>
        </div>
      </div>

      <div>
        <input formControlName="termMonths" type="number" placeholder="Term (Months)" 
               class="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-lg text-lg text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"
               [class.border-red-500]="form.get('termMonths')?.invalid && form.get('termMonths')?.touched" />
        <div *ngIf="form.get('termMonths')?.invalid && form.get('termMonths')?.touched" class="text-red-400 text-sm mt-1">
          <span *ngIf="form.get('termMonths')?.errors?.['required']">Term is required</span>
          <span *ngIf="form.get('termMonths')?.errors?.['min']">Term must be at least 1 month</span>
        </div>
      </div>
    </div>

    <!-- Minimum Sum Insured -->
    <div>
      <input formControlName="minSumInsured" type="number" placeholder="Minimum Sum Insured ($)" 
             class="w-full p-4 bg-slate-700/50 border border-slate-600 rounded-lg text-lg text-white placeholder-gray-400 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all"
             [class.border-red-500]="form.get('minSumInsured')?.invalid && form.get('minSumInsured')?.touched" />
      <div *ngIf="form.get('minSumInsured')?.invalid && form.get('minSumInsured')?.touched" class="text-red-400 text-sm mt-1">
        <span *ngIf="form.get('minSumInsured')?.errors?.['required']">Minimum sum insured is required</span>
        <span *ngIf="form.get('minSumInsured')?.errors?.['min']">Minimum sum insured must be at least $1,000</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-4">
      <button type="submit" [disabled]="(loading$ | async) || !form.valid || !imageBase64" 
              class="flex-1 py-4 rounded-lg transition-all text-lg font-medium"
              [class]="(loading$ | async) || !form.valid || !imageBase64 ? 'bg-slate-600 text-slate-400 cursor-not-allowed' : 'bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:from-purple-700 hover:to-blue-700 shadow-lg hover:shadow-purple-500/25'">
        <span *ngIf="!(loading$ | async)">Create Policy</span>
        <span *ngIf="loading$ | async" class="flex items-center justify-center">
          <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
          Creating...
        </span>
      </button>

      <button type="button" (click)="resetForm()" 
              class="px-6 py-4 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition-colors">
        Reset
      </button>
    </div>
  </form>

  <!-- Back to Admin Dashboard Link -->
  <div class="mt-8 text-center">
    <p class="text-gray-300">
      <a routerLink="/admin" class="text-purple-400 hover:text-purple-300 font-medium transition-colors">← Back to Admin Dashboard</a>
    </p>
  </div>
</div>
